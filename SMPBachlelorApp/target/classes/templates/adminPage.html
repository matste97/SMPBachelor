<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Side</title>
    <link rel="stylesheet" type="text/css" th:href="@{/styles/styles.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/styles/adminstyles.css}">
    <script th:src="@{/js/Navigation.js}"></script>
    <script th:inline="javascript">
        function confirmDelete(username, isAdmin) {
            if (isAdmin === 'true') {
                alert("Administrator brukere kan ikke slettes.");
            } else {
                var result = confirm("Er du sikker du vil slette '" + username + "' brukeren?");
                if (result) {
                    document.getElementById("deleteForm-" + username).submit();


                }
            }
            var deleteMessage = "Deleted user successfully";
            document.getElementById("deleteMessage").innerText = deleteMessage;
        }

    </script>
</head>
<body>
<nav th:replace="components/navigation"></nav>
<main>

<h1>Brukere</h1>
    <a th:href="@{/signup}">
        <button  id="newUserButton">Lag ny bruker</button>
    </a>
    <div th:if="${successMessage}" th:text="${successMessage}" id="successMessage"></div>
    <div id="deleteMessage"></div>
<ul id="usersList">
    <th:block th:each="user : ${users}">
        <div id="listUser">
            <div class="username" th:text="${user.username}"></div>
            <th:block th:if="${!user.admin}">
                <div class="button-container">
                    <button>
                        <a th:href="@{/admin/change-user-password(username=${user.username})}">Bytt passord</a>
                    </button>
                <form th:id="'deleteForm-' + ${user.username}" th:action="@{/deleteUser}" method="post">
                    <input type="hidden" name="username" th:value="${user.username}" />
                    <button type="button" class="delete-button"
                            onclick="confirmDelete(this.getAttribute('data-username'), this.getAttribute('data-admin'))"
                            th:attr="data-username=${user.username}, data-admin=${user.isAdmin}">Slett bruker</button>
                </form>

                </div>
            </th:block>

            <th:block th:if="${user.admin}">
                <div>Administrator bruker</div>
            </th:block>
        </div>
    </th:block>
</ul>


</main>
</body>
</html>